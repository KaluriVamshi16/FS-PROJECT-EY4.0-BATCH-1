{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="dashboard-container">
    {% include 'includes/sidebar.html' %}
    <div class="main-content">
        <header style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h1>My Expenses</h1>
            <a href="{% url 'add_expense' %}" class="btn-primary"
                style="text-decoration: none; border-radius: 20px; padding: 8px 20px;">+ Add Expense</a>
        </header>

        <!-- Charts Container -->
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 30px;">
            <!-- Pie Chart -->
            <div class="card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
                <h3 style="margin-top: 0; color: var(--text-primary); margin-bottom: 15px;">Category Breakdown</h3>
                <div style="position: relative; height: 300px;">
                    <canvas id="expensePieChart"></canvas>
                </div>
            </div>

            <!-- Line Chart -->
            <div class="card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
                <h3 style="margin-top: 0; color: var(--text-primary); margin-bottom: 15px;">Expense Trend</h3>
                <div style="position: relative; height: 300px;">
                    <canvas id="expenseLineChart"></canvas>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Pie Chart
                const pieCtx = document.getElementById('expensePieChart').getContext('2d');
                new Chart(pieCtx, {
                    type: 'doughnut',
                    data: {
                        labels: {{ pie_labels| safe }},
                datasets: [{
                    data: {{ pie_data| safe }},
                backgroundColor: [
                    '#4CAF50', '#81C784', '#388E3C', '#A5D6A7', '#2E7D32',
                    '#66BB6A', '#1B5E20', '#C8E6C9', '#43A047', '#00C853'
                ],
                borderWidth: 1
                        }]
                    },
                options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { boxWidth: 12, padding: 10 }
                    }
                }
            }
                });

            // Line Chart
            const lineCtx = document.getElementById('expenseLineChart').getContext('2d');
            new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: {{ line_labels| safe }},
                datasets: [{
                    label: 'Daily Expenses',
                    data: {{ line_data| safe }},
                borderColor: '#2e7d32',
                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
                        }]
                    },
                options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f0f0f0' },
                        ticks: { callback: function (value) { return '₹' + value; } }
                    },
                    x: {
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
                });
            });
        </script>

        <div class="card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
            {% if expenses %}
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #eee;">
                        <th style="padding: 10px;">Date</th>
                        <th style="padding: 10px;">Category</th>
                        <th style="padding: 10px;">Description</th>
                        <th style="padding: 10px;">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr style="border-bottom: 1px solid #f5f5f5;">
                        <td style="padding: 10px;">{{ expense.date|date:"M d, Y" }}</td>
                        <td style="padding: 10px;">{{ expense.category.name }}</td>
                        <td style="padding: 10px;">{{ expense.description }}</td>
                        <td style="padding: 10px; font-weight: bold; color: var(--primary-color);">₹{{ expense.amount }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No expenses recorded yet. Use the Chatbot to add some!</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}